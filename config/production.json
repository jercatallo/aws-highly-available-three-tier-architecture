{
  "stackName": "WebApp-Prod-MultiAZ-3TierInfra",
  "environment": {
    "name": "production",
    "region": "us-east-1"
  },
  "tags": {
    "Project": "HighlyAvailable3Tier",
    "ManagedBy": "CDK",
    "CostCenter": "Engineering",
    "Owner": "DevOps",
    "Environment": "Production"
  },
  "resourceNames": {
    "vpc": "WebApp-Prod-MultiAZ-3TierInfra-Vpc",
    "albSecurityGroup": "WebApp-Prod-MultiAZ-3TierInfra-AlbSecurityGroup",
    "webTierSecurityGroup": "WebApp-Prod-MultiAZ-3TierInfra-WebTierSecurityGroup",
    "appTierSecurityGroup": "WebApp-Prod-MultiAZ-3TierInfra-AppTierSecurityGroup",
    "databaseSecurityGroup": "WebApp-Prod-MultiAZ-3TierInfra-DatabaseSecurityGroup",
    "publicNetworkAcl": "WebApp-Prod-MultiAZ-3TierInfra-PublicNetworkAcl",
    "privateNetworkAcl": "WebApp-Prod-MultiAZ-3TierInfra-PrivateNetworkAcl",
    "applicationLoadBalancer": "WebApp-Prod-MultiAZ-3TierInfra-ApplicationLoadBalancer",
    "webTierTargetGroup": "WebApp-Prod-MultiAZ-3TierInfra-WebTierTargetGroup",
    "httpListener": "WebApp-Prod-MultiAZ-3TierInfra-HttpListener",
    "webTierAutoScalingGroup": "WebApp-Prod-MultiAZ-3TierInfra-WebTierAutoScalingGroup",
    "webTierLaunchTemplate": "WebApp-Prod-MultiAZ-3TierInfra-WebTierLaunchTemplate",
    "webTierCpuScalingPolicy": "WebApp-Prod-MultiAZ-3TierInfra-WebTierCpuScaling",
    "appTierAutoScalingGroup": "WebApp-Prod-MultiAZ-3TierInfra-AppTierAutoScalingGroup",
    "appTierLaunchTemplate": "WebApp-Prod-MultiAZ-3TierInfra-AppTierLaunchTemplate",
    "appTierCpuScalingPolicy": "WebApp-Prod-MultiAZ-3TierInfra-AppTierCpuScaling",
    "database": "WebApp-Prod-MultiAZ-3TierInfra-Database",
    "databaseSubnetGroup": "WebApp-Prod-MultiAZ-3TierInfra-DatabaseSubnetGroup",
    "databaseCredentials": "WebApp-Prod-MultiAZ-3TierInfra-DatabaseCredentials",
    "vpcFlowLogsGroup": "WebApp-Prod-MultiAZ-3TierInfra-VpcFlowLogsGroup",
    "vpcFlowLog": "WebApp-Prod-MultiAZ-3TierInfra-VpcFlowLog"
  },
  "network": {
    "vpc": {
      "cidr": "10.0.0.0/16",
      "maxAzs": 3,
      "natGatewaysCount": 3,
      "subnetCidrMask": 24,
      "enableFlowLogs": true,
      "flowLogsRetentionDays": 30,
      "subnets": {
        "publicSubnetName": "Public",
        "privateSubnetName": "Private"
      },
      "flowLogs": {
        "trafficType": "ALL",
        "logGroupRemovalPolicy": "RETAIN"
      }
    },
    "security": {
      "allowHttpFrom": "0.0.0.0/0",
      "httpPort": 80,
      "httpsPort": 443,
      "appTierPort": 8080,
      "dbPort": 3306,
      "albAllowAllOutbound": false,
      "webTierAllowAllOutbound": false,
      "appTierAllowAllOutbound": false,
      "dbAllowAllOutbound": false,
      "allowPackageDownloads": true
    },
    "networkAcls": {
      "enabled": true,
      "rules": {
        "httpInboundRuleNumber": 100,
        "enableHttpInbound": true,
        "httpsInboundRuleNumber": 105,
        "enableHttpsInbound": true,
        "ephemeralInboundRuleNumber": 110,
        "enableEphemeralInbound": true,
        "allOutboundRuleNumber": 100,
        "enableAllOutbound": true,
        "privateHttpRuleNumber": 100,
        "enablePrivateHttpInbound": true,
        "privateDatabaseRuleNumber": 110,
        "enablePrivateDatabaseInbound": true,
        "privateEphemeralRuleNumber": 120,
        "enablePrivateEphemeralInbound": true,
        "enablePrivateAllOutbound": true
      },
      "ephemeralPorts": {
        "start": 1024,
        "end": 65535
      }
    }
  },
  "compute": {
    "alb": {
      "internetFacing": true,
      "deletionProtection": true,
      "idleTimeout": 60,
      "http2Enabled": true,
      "deregistrationDelay": 30,
      "targetGroupPort": 80,
      "targetGroupProtocol": "HTTP",
      "targetType": "INSTANCE",
      "listenerPort": 80,
      "listenerProtocol": "HTTP",
      "healthCheck": {
        "enabled": true,
        "path": "/",
        "protocol": "HTTP",
        "interval": 30,
        "timeout": 5,
        "healthyThresholdCount": 2,
        "unhealthyThresholdCount": 3,
        "port": "80"
      }
    },
    "webTier": {
      "minCapacity": 3,
      "maxCapacity": 10,
      "desiredCapacity": 3,
      "instanceClass": "T3",
      "instanceSize": "SMALL",
      "machineImageType": "AMAZON_LINUX_2023",
      "healthCheckType": "ELB",
      "healthCheckGracePeriod": 300,
      "cooldown": 300,
      "targetCpuUtilization": 60,
      "requireImdsv2": true,
      "subnetType": "PRIVATE_WITH_EGRESS",
      "scaleInCooldown": 300,
      "scaleOutCooldown": 60
    },
    "appTier": {
      "minCapacity": 3,
      "maxCapacity": 10,
      "desiredCapacity": 3,
      "instanceClass": "T3",
      "instanceSize": "SMALL",
      "machineImageType": "AMAZON_LINUX_2023",
      "healthCheckType": "EC2",
      "healthCheckGracePeriod": 300,
      "cooldown": 300,
      "targetCpuUtilization": 60,
      "requireImdsv2": true,
      "subnetType": "PRIVATE_WITH_EGRESS",
      "scaleInCooldown": 300,
      "scaleOutCooldown": 60
    },
    "storage": {
      "volumeSize": 30,
      "volumeType": "GP3",
      "iops": 3000,
      "encrypted": true,
      "deleteOnTermination": true,
      "deviceName": "/dev/xvda"
    }
  },
  "monitoring": {
    "enableDetailedMonitoring": true,
    "metricCollectionGranularity": "1Minute",
    "cloudWatchLogsRetention": 30
  },
  "outputs": {
    "exportPrefix": "WebApp-Prod-MultiAZ-3TierInfra",
    "enabled": {
      "vpcId": true,
      "vpcCidr": true,
      "loadBalancerDns": true,
      "loadBalancerArn": true,
      "applicationUrl": true,
      "webTierAutoScalingGroupName": true,
      "webTierAutoScalingGroupArn": true,
      "appTierAutoScalingGroupName": true,
      "appTierAutoScalingGroupArn": true,
      "databaseEndpoint": true,
      "databasePort": true,
      "databaseSecretArn": true
    }
  },
  "database": {
    "engine": "mariadb",
    "engineVersion": "10.11",
    "instanceClass": "T3",
    "instanceSize": "SMALL",
    "allocatedStorage": 50,
    "maxAllocatedStorage": 200,
    "multiAz": true,
    "port": 3306,
    "databaseName": "appdb",
    "backupRetention": 30,
    "preferredBackupWindow": "03:00-04:00",
    "preferredMaintenanceWindow": "sun:04:00-sun:05:00",
    "deletionProtection": true,
    "removalPolicy": "RETAIN",
    "storageEncrypted": true,
    "autoMinorVersionUpgrade": true,
    "credentials": {
      "username": "admin",
      "passwordLength": 32,
      "excludePunctuation": true,
      "includeSpace": false
    },
    "cloudWatchLogs": {
      "exports": ["error", "general", "slowquery"],
      "retention": 30
    }
  }
}
